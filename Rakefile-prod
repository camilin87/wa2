import 'Rakefile'
import 'Rakefile-setup-common'

task :configure_pyenv_linux do
    alias_filename = "~/.bash_aliases"
    bash_profile = File.expand_path alias_filename

    if not File.exists? bash_profile or
        not File.readlines(bash_profile).grep(/pyenv init/).any?
        f.puts "echo alias python=python3 >> #{alias_filename}"

        `source #{alias_filename}`
    end
end

task :install_prod_dependencies do
    install_prod_system_packages
    install_pypi_prod_dependencies
end

def install_prod_system_packages
    pkg_dependencies = [
        "uwsgi"
    ]
    install_system_dependencies_linux pkg_dependencies
end

def install_system_dependencies_linux(packages)
    packages.each do |pkg|
        sh "sudo apt-get install -y #{pkg}"
    end
end

def install_pypi_prod_dependencies
    prod_packages = [
        "python-forecastio", "bottle"
    ]
    install_pypi_packages prod_packages
end
